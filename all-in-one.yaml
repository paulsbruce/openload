openload: "1.0.0"
info:
  name: All-in-one Load Test Example
  version: 1.0.0

defaults:
  http:
    headers:
      user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:63.0) Gecko/20100101 Firefox/63.0
      accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
      accept-language: en-US,en;q=0.5
      accept-encoding: gzip, deflate, br
    accept-encodings:
      - 'Gzip'
      - 'Deflate'
      - 'Brotli'

workflows:
  'Google Search': # sequential by default
    tags:
      uuid: 2f3dcd2d-2ecf-48d8-a274-9f9bceb39f1d # tags can have values
      sanity-check: # or be empty
    transaction:
      name: Go to Home
      description: "Navigate to the home page of the site"
      steps: # sequential by default
        http:
          get: https://www.google.com
          extract:
            regex: "\\{kEI:'(.*?)'"
            into:
          extract:
            xpath: "//input[@aria-label=\"I'm Feeling Lucky\"]/@id"
            into: lucky_button_id
          extract:
            regex: "\\._CONFIG=\\[\\[\\[0,\"www\\.gstatic\\.com\",\"(.*?)\""
            into: gstatic_k
          expect:
            exists: ${lucky_button_id}
            otherwise: stopthread # default is to continue
        parallel:
          headers:
            referer: https://www.google.com/
          http:
            get: https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png
          http:
            get: https://www.google.com:443/xjs/_/js/k=xjs.s.en_US.fciVZFTWDlk.O/m=sx,Fkg7bd,HcFEGb,IvlUe,MC8mtf,OF7gzc,RMhBfe,T4BAC,TJw5qb,TbaHGc,Y33vzc,cdos,cr,hsm,iDPoPb,jsa,mvYTse,tg8oTe,uz938c,vWNDde,ws9Tlc,xpltpb,yQ43ff,d,csi/am=DACLMAMB5P8UQAIIWAU2WCCDEoMS/rt=j/d=1/dg=2/rs=ACT90oER1Kbvnvu1QEwDm4_fKbF84pHs5w
          http:
            get: https://www.google.com:443/images/nav_logo242.png
        http:
          post:
            url: https://www.google.com/gen_204?s=webhp&t=aft&atyp=csi&ei=${extracted_ei}&rt=wsrt.2211,aft.242,prt.146
            headers:
              content-type: text/plain;charset=UTF-8
              te: trailers
            expect:
              status: 204
        parallel:
          http:
            get: https://ssl.gstatic.com/gb/images/i2_2ec824b0.png
          http:
            get: https://www.gstatic.com/og/_/js/k=${gstatic_k}/rt=j/m=def/exm=in,fot/d=1/ed=1/rs=AA2YrTtk6bIjehY7NvXgbRVTkE2epg5Vig
    sequential: #sequence is the default, but can be explicit too
      http:
        get: https://www.google.com
      http:
        get: http://paulsbruce.io

  'Another Test':
    http:
      get: https://www.wikipedia.org

protocols:
  'HTTP/2.0':
    '.*\.google\.com.*'

distributions:
  'Mixed Load':
    'Google Search':
      weight: 5 # will be calculated as 5/6 = 83%
      overrides: # overrides are for top-level components
        http:
          headers: # override default of Firefox to Chrome
            user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36
          caching: reset
      extensions:
        network-virtualization:
          download:
            max: 528Kbps
            latency: 350ms
            packet-loss: 5%
          upload:
            max: 21Kbps
            latency: 370ms
            packet-loss: 0%
    'Another Test':
      weight: 1 # will be calculated as 1/6 = 17%
      overrides:
        http:
          cookies: false
          parallel-connections: 6
          protocols:
            'HTTP/2.0': false
  'Just Google':
    'Google Search':
      weight: 1 # 100%

execution:
  plan:
    name: Sanity Scenario
    groups:
      'Mixed Load':
        $ref: '#/distributions/Mixed Load'
        infrastructure:
          include: all # is the default
      'Just Google':
        $ref: '#/distributions/Just Google'
        infrastructure:
          exclude:
            tags:
              US-WEST-1

infrastructures:
  'hub':
    type: orchestrator
    tags:
      autorecover: false

  '10.0.0.201':
    type: node
    tags:
      US-WEST-1
    uri: 'ssh://10.0.0.201:7100'
    credentials: ...
  'AWS Lambda': # completelyconceptual  placeholder
    tags:
      cloud
    extensions:
      computegroup: ...
      max-node-throughput: 200rps
      autoscale: true


#credentials:
#  TBD


#authentication:
#  '.*\.google\.com.*':
#    oauth:
#      version: 2.0
#      ...
